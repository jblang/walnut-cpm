 *				OFFBASE.CMD
 *				Mike Olfe Lifelines July 82
 *
 *				Parameter passing to subroutine
*
*				Entered 05/19/83
*


SET ECHO OFF
SET TALK OFF
ERASE

* DISPLAY CURRENT FCB

STOR (5*16)+13 TO FCBL
STOR 0 TO COUNT
STOR ' ' TO s
DO WHILE COUNT<12
STOR s+CHR(PEEK(FCBL+COUNT)) TO s
STOR COUNT +1 TO COUNT
ENDD
@ 10,0 SAY "Current FCB= "+S

* BLANK THE FCB
POKE FCBL,32,32,32,32,32,32,32,32,32,32,32,0,0,0,0,0

* GET parameters for called program

STOR '        **' TO PARAM

* Truncate, capitalise for CP/M

STOR TRIM(PARAM) TO PARAM
STOR !(PARAM) TO PARAM

* Convert ASCII to DECIMAL

STOR '*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`' TO TABLE
STOR 41 TO BASE
STOR ' ' TO DSTRING
STOR 0 TO POINTER
DO WHILE POINTER<LEN(PARAM)
STOR S(PARAM,POINTER+1,1) SRCHCHAR
STOR @(SRCHCHAR, TABLE) TO POSITION
STOR DSTRING+ STR(POSITION+BASE,2)+',' TO DSTRING
STOR POINTER +1 TO POINTER
ENDDO

* Remove last comma

STORE LEN(DSTRING) TO LENG
STORE $(DSTRING,1,LENG-1) TO DSTRING


* POKE THE FCB


STOR 5*(16)+13 TO FCBL
POKE FCBL,&DSTRING


* SET UP CALL ADDRESS


STOR 10*(16*16*16) TO CA
STOR CA+(4*(16*16)) TO CA
SET CALL TO CA
STOR 'DUMMY' TO ADRESS


* DO THE CALL

CALL  ADRESS 


*
*			END OFFBASE.CMD
*
